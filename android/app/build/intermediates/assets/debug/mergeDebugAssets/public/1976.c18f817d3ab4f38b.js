"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1976],{1976:(v,g,n)=>{n.r(g),n.d(g,{RegistroPageModule:()=>M});var h=n(2200),u=n(4341),a=n(9420),m=n(8132),p=n(467),f=n(9176),t=n(3664),l=n(2615),b=n(6344),C=n(747);function E(i,d){if(1&i){const e=t.RV6();t.j41(0,"ion-toggle",10),t.bIt("ionChange",function(s){l.eBV(e);const o=t.XpG().$index,c=t.XpG();return l.Njj(c.toggleAsistencia(c.asistencias[o],s.detail.checked))}),t.k0s()}if(2&i){const e=t.XpG().$index,r=t.XpG();t.Y8G("checked",r.asistencias[e].presente)}}function _(i,d){if(1&i){const e=t.RV6();t.j41(0,"span",11),t.EFF(1," \u2714\ufe0f Asistencia Confirmada "),t.k0s(),t.j41(2,"ion-button",12),t.bIt("click",function(){l.eBV(e);const s=t.XpG().$index,o=t.XpG();return l.Njj(o.confirmarYEliminarEntrada(o.asistencias[s].id))}),t.EFF(3," Eliminar "),t.k0s()}}function P(i,d){if(1&i&&(t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.k0s(),t.j41(11,"td"),t.EFF(12),t.k0s(),t.j41(13,"td"),t.nVh(14,E,1,1,"ion-toggle",9)(15,_,4,0),t.k0s()()),2&i){const e=d.$implicit,r=d.$index,s=t.XpG();t.R7$(2),t.JRh(e.id),t.R7$(2),t.JRh(e.nombre),t.R7$(2),t.JRh(e.apellido),t.R7$(2),t.JRh(e.correo),t.R7$(2),t.JRh(e.telefono),t.R7$(2),t.E5c("",null==e.tutor?null:e.tutor.nombre," ",null==e.tutor?null:e.tutor.apellidoPaterno," ",null==e.tutor?null:e.tutor.apellidoMaterno),t.R7$(2),t.vxM(s.asistencias[r].registrada?15:14)}}const x=[{path:"",component:(()=>{class i{constructor(e,r,s,o){this.api=e,this.asistenciasService=r,this.toastController=s,this.alertController=o,this.instructoresFiltrados=[],this.asistencias=[],this.idGrupo=0;const c=JSON.parse(localStorage.getItem("usuario"));c&&"maestro"===c.rol&&this.obtenerGrupoPorCorreo(c.correo)}obtenerAlumnosPorGrupo(){this.api.getAlumnosPorGrupo(this.idGrupo).subscribe({next:e=>{this.instructoresFiltrados=[...e],this.asistencias=this.instructoresFiltrados.map(r=>({alumno_id:r.id,presente:!1,registrada:!1})),this.obtenerEntradasRegistradas()},error:e=>{console.error("Error al obtener los alumnos:",e)}})}obtenerGrupoPorCorreo(e){this.api.getPerfilMaestroPorCorreo(e).subscribe({next:r=>{this.idGrupo=r.grupoId,this.obtenerAlumnosPorGrupo()},error:r=>{console.error("Error al obtener el perfil del maestro:",r)}})}marcarAsistencia(e,r){this.asistencias[e]&&(this.asistencias[e].presente=r,r&&!this.asistencias[e].registrada&&this.asistenciasService.registrarEntrada(this.asistencias[e].alumno_id).subscribe({next:()=>{this.asistencias[e].registrada=!0},error:s=>{409===s.status?(alert(`El alumno con ID ${this.asistencias[e].alumno_id} ya tiene asistencia registrada hoy.`),this.asistencias[e].registrada=!0):(alert(`Error al registrar asistencia para alumno ID ${this.asistencias[e].alumno_id}`),console.error(s))}}))}guardarAsistencias(){const e=this.asistencias.filter(r=>r.presente&&!r.registrada);0!==e.length?e.forEach(r=>{this.asistenciasService.registrarEntrada(r.alumno_id).subscribe({next:()=>{r.registrada=!0,this.mostrarToast(`Asistencia registrada para el alumno ID ${r.alumno_id}`)},error:s=>{409===s.status?(this.mostrarToast(`El alumno con ID ${r.alumno_id} ya tiene asistencia registrada hoy.`,"warning"),r.registrada=!0):(this.mostrarToast(`Error al registrar asistencia para alumno ID ${r.alumno_id}`,"danger"),console.error(s))}})}):alert("No hay asistencias nuevas para registrar.")}mostrarToast(e){var r=this;return(0,p.A)(function*(s,o="success"){yield(yield r.toastController.create({message:s,duration:2e3,color:o,position:"bottom"})).present()}).apply(this,arguments)}obtenerEntradasRegistradas(){this.asistenciasService.getEntradasPorGrupo(this.idGrupo).subscribe({next:e=>{this.asistencias=this.instructoresFiltrados.map(r=>{const s=e.find(o=>o.alumno.id===r.id);return{id:s?.id||0,alumno_id:r.id,presente:!!s,registrada:!!s}})},error:e=>{console.error("Error al obtener entradas:",e)}})}modificarAsistencia(e,r){e.id?r||this.eliminarEntrada(e.id):this.asistenciasService.registrarEntrada(e.alumno_id).subscribe({next:()=>{e.presente=!0,e.registrada=!0,this.mostrarToast("Asistencia registrada")},error:s=>{this.mostrarToast("Error al registrar asistencia","danger")}})}toggleAsistencia(e,r){r?e.registrada||this.asistenciasService.registrarEntrada(e.alumno_id).subscribe({next:s=>{e.presente=!0,e.registrada=!0,e.id=s.id,this.mostrarToast("Asistencia registrada")},error:s=>{409===s.status?(this.mostrarToast("Asistencia ya registrada","warning"),e.registrada=!0,e.presente=!0):this.mostrarToast("Error al registrar asistencia","danger")}}):(e.presente=!0,this.mostrarToast("Para eliminar, usa el bot\xf3n Eliminar","warning"))}eliminarAsistencia(e){e.id?this.asistenciasService.eliminarEntrada(e.id).subscribe({next:()=>{e.presente=!1,e.registrada=!1,e.id=0,this.mostrarToast("Asistencia eliminada")},error:r=>{this.mostrarToast("Error al eliminar asistencia","danger"),console.error(r)}}):this.mostrarToast("No hay asistencia registrada para eliminar","warning")}confirmarYEliminarEntrada(e){var r=this;return(0,p.A)(function*(){yield(yield r.alertController.create({header:"Confirmar eliminaci\xf3n",message:"\xbfSeguro que quieres eliminar esta asistencia?",buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary"},{text:"Eliminar",handler:()=>{r.eliminarEntrada(e)}}]})).present()})()}eliminarEntrada(e){this.asistenciasService.eliminarEntrada(e).subscribe({next:()=>{const r=this.asistencias.findIndex(s=>s.id===e);-1!==r&&(this.asistencias[r].presente=!1,this.asistencias[r].registrada=!1,this.asistencias[r].id=0),this.mostrarToast("Asistencia eliminada")},error:r=>{this.mostrarToast("Error al eliminar asistencia","danger"),console.error(r)}})}static#t=this.\u0275fac=function(r){return new(r||i)(t.rXU(b.G),t.rXU(C.f),t.rXU(a.K_),t.rXU(a.hG))};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["app-registro"]],decls:38,vars:2,consts:[[3,"translucent"],["color","primary",1,"ion-text-center"],["slot","start"],["defaultHref","/","text",""],["color","light"],["size","small",1,"ion-text-center"],[1,"ion-padding",3,"fullscreen"],[2,"overflow-x","auto","max-height","400px","overflow-y","auto"],[2,"min-width","900px","border-collapse","collapse","width","100%"],[3,"checked"],[3,"ionChange","checked"],[2,"color","green","font-weight","bold"],["color","danger","size","small",3,"click"]],template:function(r,s){1&r&&(t.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),t.EFF(3,"CREDENCIAL DIGITAL"),t.k0s(),t.j41(4,"ion-buttons",2),t.nrm(5,"ion-back-button",3),t.k0s()(),t.j41(6,"ion-toolbar",4)(7,"ion-title",5)(8,"ion-card-subtitle"),t.EFF(9,"REGISTRO DE ASISTENCIAS"),t.k0s()()()(),t.j41(10,"ion-content",6)(11,"ion-card")(12,"ion-card-header")(13,"ion-card-title"),t.EFF(14,"Lista de Mis Alumnos"),t.k0s()(),t.j41(15,"ion-card-content")(16,"div",7)(17,"table",8)(18,"thead")(19,"tr")(20,"th"),t.EFF(21,"ID"),t.k0s(),t.j41(22,"th"),t.EFF(23,"Nombre"),t.k0s(),t.j41(24,"th"),t.EFF(25,"Apellidos"),t.k0s(),t.j41(26,"th"),t.EFF(27,"Email"),t.k0s(),t.j41(28,"th"),t.EFF(29,"Tel\xe9fono"),t.k0s(),t.j41(30,"th"),t.EFF(31,"Tutor"),t.k0s(),t.j41(32,"th"),t.EFF(33,"Asistencia"),t.k0s()()(),t.j41(34,"tbody"),t.Z7z(35,P,16,9,"tr",null,t.fX1),t.k0s()()()()()(),t.nrm(37,"app-footer")),2&r&&(t.Y8G("translucent",!0),t.R7$(10),t.Y8G("fullscreen",!0),t.R7$(25),t.Dyx(s.instructoresFiltrados))},dependencies:[a.bv,a.Jm,a.QW,a.b_,a.I9,a.ME,a.HW,a.tN,a.W9,a.eU,a.BC,a.BY,a.ai,a.hB,a.el,u.YN,h.MD,f.t],styles:['@charset "UTF-8";.table-container[_ngcontent-%COMP%]{max-height:420px;overflow-y:auto;overflow-x:auto;border:1px solid #ddd;border-radius:6px}table.styled-table[_ngcontent-%COMP%]{border-collapse:collapse;width:100%;min-width:900px;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#3880ff;color:#fff;z-index:10}thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:12px 15px;text-align:left;border-bottom:2px solid #2665d6;box-shadow:inset 0 -1px #2665d6}thead[_ngcontent-%COMP%]   th.col-id[_ngcontent-%COMP%]{width:60px}thead[_ngcontent-%COMP%]   th.col-nombre[_ngcontent-%COMP%], thead[_ngcontent-%COMP%]   th.col-apellidos[_ngcontent-%COMP%]{width:150px}thead[_ngcontent-%COMP%]   th.col-email[_ngcontent-%COMP%]{width:200px}thead[_ngcontent-%COMP%]   th.col-telefono[_ngcontent-%COMP%]{width:130px}thead[_ngcontent-%COMP%]   th.col-tutor[_ngcontent-%COMP%]{width:200px}thead[_ngcontent-%COMP%]   th.col-asistencia[_ngcontent-%COMP%]{width:160px}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background-color:#f9f9f9;transition:background-color .3s ease}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f1f1f1}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#e1eaff}tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 15px;border-bottom:1px solid #ddd;vertical-align:middle}.asistencia-confirmada[_ngcontent-%COMP%]{color:green;font-weight:700;margin-left:8px}ion-toggle[_ngcontent-%COMP%]{vertical-align:middle;--handle-background-checked: #10dc60}ion-button[_ngcontent-%COMP%]{margin-left:8px;vertical-align:middle}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{white-space:nowrap}']})}return i})()}];let F=(()=>{class i{static#t=this.\u0275fac=function(r){return new(r||i)};static#e=this.\u0275mod=t.$C({type:i});static#r=this.\u0275inj=l.G2t({imports:[m.iI.forChild(x),m.iI]})}return i})(),M=(()=>{class i{static#t=this.\u0275fac=function(r){return new(r||i)};static#e=this.\u0275mod=t.$C({type:i});static#r=this.\u0275inj=l.G2t({imports:[h.MD,u.YN,a.bv,F]})}return i})()}}]);