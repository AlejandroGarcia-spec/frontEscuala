"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8078],{3817:(f,g,u)=>{u.d(g,{b:()=>i});var p=u(2615),h=u(9330);let i=(()=>{class d{constructor(e){this.http=e,this.apiUrl="https://backescolar-production.up.railway.app/grupos"}obtenerGrupos(){return this.http.get(`${this.apiUrl}/getAll`)}obtenerGrupoPorId(e){return this.http.get(`${this.apiUrl}/${e}`)}crearGrupo(e){return this.http.post(`${this.apiUrl}/post`,e)}actualizarGrupo(e,t){return this.http.patch(`${this.apiUrl}/${e}`,t)}eliminarGrupo(e){return this.http.delete(`${this.apiUrl}/${e}`)}static#t=this.\u0275fac=function(t){return new(t||d)(p.KVO(h.Qq))};static#o=this.\u0275prov=p.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})()},6993:(f,g,u)=>{u.d(g,{p:()=>i});var p=u(2615),h=u(9330);let i=(()=>{class d{constructor(e){this.http=e,this.apiUrl="https://backescolar-production.up.railway.app/alumnos"}crearAlumno(e){return this.http.post(`${this.apiUrl}`,e)}obtenerAlumnos(){return this.http.get(this.apiUrl)}obtenerAlumnoPorId(e){return this.http.get(`${this.apiUrl}/${e}`)}obtenerPorTutor(e){return this.http.get(`${this.apiUrl}/tutor/${e}`)}obtenerPorGrupo(e){return this.http.get(`${this.apiUrl}/grupo/${e}`)}actualizarAlumno(e,t){return this.http.patch(`${this.apiUrl}/${e}`,t)}eliminarAlumno(e){return this.http.delete(`${this.apiUrl}/${e}`)}obtenerPorMaestro(e){return this.http.get(`${this.apiUrl}/maestro/${e}/alumnos`)}static#t=this.\u0275fac=function(t){return new(t||d)(p.KVO(h.Qq))};static#o=this.\u0275prov=p.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})()},8078:(f,g,u)=>{u.r(g),u.d(g,{EscanearQrPageModule:()=>H});var p=u(2200),h=u(4341),i=u(9420),d=u(8132),_=u(467),e=u(4104),t=u(3664),l=u(2615),E=u(9330);let C=(()=>{class r{constructor(o){this.http=o,this.apiUrl="https://backescolar-production.up.railway.app"}getFotoAutorizado(o,a){return this.http.get("tutor"===o?`${this.apiUrl}/tutores/${a}`:`${this.apiUrl}/conocidos/get/${a}`)}static#t=this.\u0275fac=function(a){return new(a||r)(l.KVO(E.Qq))};static#o=this.\u0275prov=l.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var x=u(2037),b=u(6993),$=u(3817);const j=(r,c)=>c.nombre,R=(r,c)=>c.id;function v(r,c){if(1&r){const o=t.RV6();t.j41(0,"ion-button",8),t.bIt("click",function(){l.eBV(o);const n=t.XpG();return l.Njj(n.mostrarEscanner())}),t.nrm(1,"ion-icon",9),t.EFF(2," Leer QR "),t.k0s()}}function G(r,c){if(1&r){const o=t.RV6();t.j41(0,"zxing-scanner",12),t.bIt("scanSuccess",function(n){l.eBV(o);const s=t.XpG(2);return l.Njj(s.onCodeResult(n))}),t.k0s()}2&r&&t.Y8G("torch",!0)("tryHarder",!0)}function k(r,c){if(1&r){const o=t.RV6();t.j41(0,"ion-button",13),t.bIt("click",function(){l.eBV(o);const n=t.XpG(2);return l.Njj(n.ocultarEscanner())}),t.EFF(1," Cerrar Esc\xe1ner "),t.k0s()}}function S(r,c){if(1&r&&t.nrm(0,"img",14),2&r){const o=t.XpG(3);t.Y8G("src",o.autorizado.foto,t.B4B)}}function T(r,c){if(1&r){const o=t.RV6();t.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),t.EFF(3),t.k0s()(),t.j41(4,"ion-card-content")(5,"p")(6,"strong"),t.EFF(7,"Autorizado:"),t.k0s(),t.EFF(8),t.k0s(),t.j41(9,"p")(10,"strong"),t.EFF(11,"Parentesco:"),t.k0s(),t.EFF(12),t.k0s(),t.nVh(13,S,1,1,"img",14),t.j41(14,"ion-item")(15,"ion-label"),t.EFF(16,"Autorizar salida"),t.k0s(),t.j41(17,"ion-toggle",15),t.mxI("ngModelChange",function(n){l.eBV(o);const s=t.XpG(2);return t.DH7(s.salidaAutorizada,n)||(s.salidaAutorizada=n),l.Njj(n)}),t.k0s()(),t.j41(18,"ion-button",16),t.bIt("click",function(){l.eBV(o);const n=t.XpG(2);return l.Njj(n.confirmarSalida())}),t.EFF(19," Confirmar autorizaci\xf3n "),t.k0s(),t.j41(20,"ion-button",17),t.bIt("click",function(){l.eBV(o);const n=t.XpG(2);return l.Njj(n.reset())}),t.EFF(21,"Cancelar"),t.k0s()()()}if(2&r){const o=t.XpG(2);t.R7$(3),t.Lme("",o.alumno.nombre," - ",o.alumno.grado),t.R7$(5),t.Lme(" ",o.autorizado.nombre," ",o.autorizado.apellido),t.R7$(4),t.SpI(" ",o.autorizado.parentesco),t.R7$(),t.vxM(o.autorizado.foto?13:-1),t.R7$(4),t.R50("ngModel",o.salidaAutorizada),t.R7$(),t.Y8G("disabled",!o.salidaAutorizada)}}function P(r,c){if(1&r&&(t.j41(0,"div"),t.nVh(1,G,1,2,"zxing-scanner",10),t.nVh(2,k,2,0,"ion-button",11),t.nVh(3,T,22,8,"ion-card"),t.k0s()),2&r){const o=t.XpG();t.R7$(),t.vxM(o.alumno?-1:1),t.R7$(),t.vxM(o.alumno?-1:2),t.R7$(),t.vxM(o.alumno?3:-1)}}function M(r,c){if(1&r&&(t.j41(0,"ion-select-option",21),t.EFF(1),t.k0s()),2&r){const o=c.$implicit;t.Y8G("value",o.nombre),t.R7$(),t.SpI(" ",o.nombre," ")}}function z(r,c){if(1&r&&(t.j41(0,"ion-select-option",21),t.EFF(1),t.k0s()),2&r){const o=c.$implicit;t.Y8G("value",o),t.R7$(),t.SpI(" ",o," ")}}function Q(r,c){if(1&r){const o=t.RV6();t.j41(0,"ion-item-sliding")(1,"ion-item")(2,"ion-grid")(3,"ion-row")(4,"ion-col",24)(5,"ion-label")(6,"h2")(7,"strong"),t.EFF(8),t.k0s()(),t.j41(9,"p"),t.nrm(10,"ion-icon",25),t.EFF(11),t.k0s(),t.j41(12,"p"),t.nrm(13,"ion-icon",26),t.EFF(14),t.k0s()()(),t.j41(15,"ion-col",27)(16,"ion-label")(17,"p")(18,"strong"),t.EFF(19),t.k0s()(),t.j41(20,"p",28),t.EFF(21),t.k0s()()()()()(),t.j41(22,"ion-item-options",29)(23,"ion-item-option",30),t.bIt("click",function(){const n=l.eBV(o).$implicit,s=t.XpG(3);return l.Njj(s.eliminarSalida(n.id))}),t.nrm(24,"ion-icon",31),t.EFF(25," Eliminar "),t.k0s()()()}if(2&r){const o=c.$implicit,a=t.XpG(3);t.R7$(8),t.JRh(a.obtenerNombreAlumno(o)),t.R7$(3),t.SpI(" ",a.obtenerNombreGrupo(o)),t.R7$(3),t.SpI(" ",o.nombre_Recoge),t.R7$(5),t.JRh(a.formatearHora(o.Date)),t.R7$(2),t.JRh(a.formatearFecha(o.Date))}}function y(r,c){if(1&r&&(t.j41(0,"div"),t.Z7z(1,Q,26,5,"ion-item-sliding",null,R),t.k0s()),2&r){const o=t.XpG(2);t.R7$(),t.Dyx(o.salidasFiltradas)}}function A(r,c){1&r&&(t.j41(0,"h2"),t.EFF(1,"No hay salidas registradas"),t.k0s())}function I(r,c){1&r&&(t.j41(0,"h2"),t.EFF(1,"No hay salidas con los filtros seleccionados"),t.k0s())}function U(r,c){1&r&&(t.j41(0,"p"),t.EFF(1,"Los registros aparecer\xe1n aqu\xed"),t.k0s())}function D(r,c){if(1&r&&(t.j41(0,"p"),t.EFF(1,"Grupo: "),t.j41(2,"strong"),t.EFF(3),t.k0s()()),2&r){const o=t.XpG(3);t.R7$(3),t.JRh(o.filtroGrupo)}}function V(r,c){if(1&r&&(t.j41(0,"p"),t.EFF(1,"Fecha: "),t.j41(2,"strong"),t.EFF(3),t.k0s()()),2&r){const o=t.XpG(3);t.R7$(3),t.JRh(o.filtroFecha)}}function X(r,c){if(1&r&&(t.j41(0,"ion-item")(1,"ion-label",32),t.nrm(2,"ion-icon",33),t.nVh(3,A,2,0,"h2"),t.nVh(4,I,2,0,"h2"),t.nVh(5,U,2,0,"p"),t.nVh(6,D,4,1,"p"),t.nVh(7,V,4,1,"p"),t.k0s()()),2&r){const o=t.XpG(2);t.R7$(3),t.vxM(o.filtroGrupo||o.filtroFecha?-1:3),t.R7$(),t.vxM(o.filtroGrupo||o.filtroFecha?4:-1),t.R7$(),t.vxM(o.filtroGrupo||o.filtroFecha?-1:5),t.R7$(),t.vxM(o.filtroGrupo?6:-1),t.R7$(),t.vxM(o.filtroFecha?7:-1)}}function N(r,c){if(1&r){const o=t.RV6();t.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),t.EFF(3,"Historial de Salidas"),t.k0s(),t.j41(4,"ion-grid")(5,"ion-row")(6,"ion-col",18)(7,"ion-item")(8,"ion-select",19),t.mxI("ngModelChange",function(n){l.eBV(o);const s=t.XpG();return t.DH7(s.filtroGrupo,n)||(s.filtroGrupo=n),l.Njj(n)}),t.bIt("ionChange",function(){l.eBV(o);const n=t.XpG();return l.Njj(n.onFiltroGrupoChange())}),t.j41(9,"ion-select-option",20),t.EFF(10,"Todos"),t.k0s(),t.Z7z(11,M,2,2,"ion-select-option",21,j),t.k0s()()(),t.j41(13,"ion-col",18)(14,"ion-item")(15,"ion-select",22),t.mxI("ngModelChange",function(n){l.eBV(o);const s=t.XpG();return t.DH7(s.filtroFecha,n)||(s.filtroFecha=n),l.Njj(n)}),t.bIt("ionChange",function(){l.eBV(o);const n=t.XpG();return l.Njj(n.onFiltroFechaChange())}),t.j41(16,"ion-select-option",20),t.EFF(17,"Todas"),t.k0s(),t.Z7z(18,z,2,2,"ion-select-option",21,t.fX1),t.k0s()()()()()(),t.j41(20,"ion-card-content",23),t.nVh(21,y,3,0,"div")(22,X,8,5,"ion-item"),t.k0s()()}if(2&r){const o=t.XpG();t.R7$(8),t.R50("ngModel",o.filtroGrupo),t.R7$(3),t.Dyx(o.grupos),t.R7$(4),t.R50("ngModel",o.filtroFecha),t.R7$(3),t.Dyx(o.fechas),t.R7$(3),t.vxM(o.salidasFiltradas.length>0?21:22)}}const B=[{path:"",component:(()=>{class r{constructor(o,a,n,s,m,F){this.autorizadoService=o,this.salidasService=a,this.alumnosService=n,this.gruposService=s,this.toastController=m,this.alertController=F,this.alumno=null,this.autorizado=null,this.salidaAutorizada=!1,this.qrResult="",this.mostrarScanner=!1,this.salidas=[],this.salidasFiltradas=[],this.grupos=[],this.fechas=[],this.filtroGrupo="",this.filtroFecha=""}ngOnInit(){this.cargarSalidas(),this.cargarGrupos()}cargarSalidas(){this.salidasService.obtenerSalidas().subscribe({next:o=>{console.log("Salidas cargadas:",o),this.salidas=o||[],this.salidasFiltradas=this.salidas,this.extraerFechasUnicas()},error:o=>{console.error("Error al cargar salidas:",o),this.salidas=[],this.salidasFiltradas=[]}})}cargarGrupos(){this.gruposService.obtenerGrupos().subscribe({next:o=>{console.log("Grupos cargados:",o),this.grupos=o||[]},error:o=>{console.error("Error al cargar grupos:",o),this.alumnosService.obtenerAlumnos().subscribe({next:a=>{const n=[...new Set(a.map(s=>s.grupo?.nombre||s.grado).filter(Boolean))];this.grupos=n.map(s=>({nombre:s}))},error:a=>{console.error("Error al cargar alumnos:",a),this.grupos=[]}})}})}extraerFechasUnicas(){if(!this.salidas||0===this.salidas.length)return void(this.fechas=[]);const o=[...new Set(this.salidas.map(a=>this.formatearFecha(a.Date)))];this.fechas=o.sort((a,n)=>new Date(n).getTime()-new Date(a).getTime())}aplicarFiltros(){this.salidas&&(this.salidasFiltradas=this.salidas.filter(o=>!(this.filtroFecha&&this.formatearFecha(o.Date)!==this.filtroFecha||this.filtroGrupo&&(o.alumno?.grupo?.nombre||o.alumno?.grado||"")!==this.filtroGrupo)),console.log(`Filtros aplicados - Grupo: "${this.filtroGrupo}", Fecha: "${this.filtroFecha}"`),console.log(`Salidas filtradas: ${this.salidasFiltradas.length} de ${this.salidas.length}`))}onFiltroGrupoChange(){this.aplicarFiltros()}onFiltroFechaChange(){this.aplicarFiltros()}mostrarEscanner(){this.mostrarScanner=!0}ocultarEscanner(){this.mostrarScanner=!1,this.reset()}onCodeResult(o){this.qrResult=o;try{const a=JSON.parse(o);console.log(a),this.alumno={id:a.estudiante.id,nombre:a.estudiante.nombre,grado:a.estudiante.grado},this.autorizado={...a.autorizadoRecoger,foto:null},this.autorizado.id&&this.autorizadoService.getFotoAutorizado(this.autorizado.tipo,this.autorizado.id).subscribe(n=>{this.autorizado.foto=n.foto||"https://via.placeholder.com/150"})}catch(a){console.error("Error al parsear QR:",a),alert("QR inv\xe1lido")}}confirmarSalida(){var o=this;return(0,_.A)(function*(){const a={nombre_Recoge:`${o.autorizado.nombre} ${o.autorizado.apellido}`,alumnoId:Number(o.alumno.id)};var n;o.salidasService.crearSalida(a).subscribe({next:(n=(0,_.A)(function*(){yield o.mostrarToast("\u2705 Salida registrada exitosamente","success"),o.reset(),o.mostrarScanner=!1,o.cargarSalidas()}),function(){return n.apply(this,arguments)}),error:function(){var n=(0,_.A)(function*(s){console.error("Error al registrar salida:",s),yield o.mostrarToast("\u274c Error al registrar la salida","danger")});return function(m){return n.apply(this,arguments)}}()})})()}eliminarSalida(o){var a=this;return(0,_.A)(function*(){yield(yield a.alertController.create({header:"Confirmar eliminaci\xf3n",message:"\xbfEst\xe1 seguro de eliminar esta salida?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"destructive",handler:()=>{var s;a.salidasService.eliminarSalida(o).subscribe({next:(s=(0,_.A)(function*(){yield a.mostrarToast("Salida eliminada correctamente","warning"),a.cargarSalidas()}),function(){return s.apply(this,arguments)}),error:function(){var s=(0,_.A)(function*(m){console.error("Error al eliminar salida:",m),yield a.mostrarToast("\u274c Error al eliminar la salida","danger")});return function(F){return s.apply(this,arguments)}}()})}}]})).present()})()}formatearHora(o){return o?new Date(o).toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"}):""}formatearFecha(o){return o?new Date(o).toLocaleDateString("es-MX"):""}obtenerNombreGrupo(o){return o.alumno?.grupo?.nombre||o.alumno?.grado||"Sin grupo"}obtenerNombreAlumno(o){return o.alumno?`${o.alumno.nombre||""} ${o.alumno.apellido||""}`.trim():"Sin datos"}reset(){this.alumno=null,this.autorizado=null,this.qrResult="",this.salidaAutorizada=!1}mostrarToast(o){var a=this;return(0,_.A)(function*(n,s="success"){yield(yield a.toastController.create({message:n,duration:3e3,color:s,position:"bottom",buttons:[{text:"Cerrar",role:"cancel"}]})).present()}).apply(this,arguments)}static#t=this.\u0275fac=function(a){return new(a||r)(t.rXU(C),t.rXU(x.j),t.rXU(b.p),t.rXU($.b),t.rXU(i.K_),t.rXU(i.hG))};static#o=this.\u0275cmp=t.VBU({type:r,selectors:[["app-escanear-qr"]],decls:14,vars:4,consts:[[3,"translucent"],["color","primary",1,"ion-text-center"],["slot","start"],["defaultHref","/","text",""],["color","light"],["size","small",1,"ion-text-center"],[1,"ion-padding"],["expand","block","color","primary",2,"margin-bottom","20px"],["expand","block","color","primary",2,"margin-bottom","20px",3,"click"],["name","qr-code-outline","slot","start"],[3,"torch","tryHarder"],["expand","block","color","medium",2,"margin-top","10px"],[3,"scanSuccess","torch","tryHarder"],["expand","block","color","medium",2,"margin-top","10px",3,"click"],[2,"width","100px","border-radius","8px",3,"src"],[3,"ngModelChange","ngModel"],["expand","block","color","success",3,"click","disabled"],["expand","block","color","medium",3,"click"],["size","6"],["placeholder","Grupo","interface","action-sheet",3,"ngModelChange","ionChange","ngModel"],["value",""],[3,"value"],["placeholder","Fecha","interface","action-sheet",3,"ngModelChange","ionChange","ngModel"],[2,"padding","0"],["size","8"],["name","school-outline"],["name","person-outline"],["size","4",1,"ion-text-right"],[2,"font-size","0.8em"],["side","end"],["color","danger",3,"click"],["name","trash-outline"],[1,"ion-text-center"],["name","clipboard-outline","size","large"]],template:function(a,n){1&a&&(t.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),t.EFF(3,"CREDENCIAL DIGITAL"),t.k0s(),t.j41(4,"ion-buttons",2),t.nrm(5,"ion-back-button",3),t.k0s()(),t.j41(6,"ion-toolbar",4)(7,"ion-title",5)(8,"ion-card-subtitle"),t.EFF(9,"REGISTRO DE SALIDAS"),t.k0s()()()(),t.j41(10,"ion-content",6),t.nVh(11,v,3,0,"ion-button",7),t.nVh(12,P,4,3,"div"),t.nVh(13,N,23,3,"ion-card"),t.k0s()),2&a&&(t.Y8G("translucent",!0),t.R7$(11),t.vxM(n.mostrarScanner?-1:11),t.R7$(),t.vxM(n.mostrarScanner?12:-1),t.R7$(),t.vxM(n.mostrarScanner?-1:13))},dependencies:[i.bv,i.Jm,i.QW,i.b_,i.I9,i.ME,i.HW,i.tN,i.hU,i.W9,i.lO,i.eU,i.iq,i.uz,i.LU,i.CE,i.A7,i.he,i.ln,i.Nm,i.Ip,i.BC,i.BY,i.ai,i.hB,i.Je,i.el,h.YN,h.BC,h.vS,p.MD,h.X1,e.x,e.M],encapsulation:2})}return r})()}];let O=(()=>{class r{static#t=this.\u0275fac=function(a){return new(a||r)};static#o=this.\u0275mod=t.$C({type:r});static#r=this.\u0275inj=l.G2t({imports:[d.iI.forChild(B),d.iI]})}return r})(),H=(()=>{class r{static#t=this.\u0275fac=function(a){return new(a||r)};static#o=this.\u0275mod=t.$C({type:r});static#r=this.\u0275inj=l.G2t({imports:[p.MD,h.YN,i.bv,O,e.x]})}return r})()}}]);