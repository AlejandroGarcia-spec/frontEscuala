<ion-header>
  <ion-toolbar color="primary">
    <ion-title>
      <div class="header-content">
        <ion-icon name="create-outline" slot="start"></ion-icon>
        Editar Alumno
      </div>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cerrarModal()" fill="clear">
        <ion-icon name="close" size="large"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form [formGroup]="alumnoForm" (ngSubmit)="guardarAlumno()">
    <!-- Información Personal -->
    <div class="form-section">
      <h3 class="section-title">
        <ion-icon name="person-outline"></ion-icon>
        Información Personal
      </h3>
      
      <ion-item fill="outline" class="form-item">
        <ion-label position="floating">Nombre *</ion-label>
        <ion-input formControlName="nombre" type="text"></ion-input>
        <ion-icon name="person-outline" slot="start" color="medium"></ion-icon>
      </ion-item>
      @if (alumnoForm.get('nombre')?.invalid && alumnoForm.get('nombre')?.touched) {
        <div class="error-message">
          <ion-icon name="alert-circle-outline"></ion-icon>
          El nombre es requerido y debe tener mínimo 2 letras
        </div>
      }

      <ion-item fill="outline" class="form-item">
        <ion-label position="floating">Apellido *</ion-label>
        <ion-input formControlName="apellido" type="text"></ion-input>
        <ion-icon name="person-outline" slot="start" color="medium"></ion-icon>
      </ion-item>
      @if (alumnoForm.get('apellido')?.invalid && alumnoForm.get('apellido')?.touched) {
        <div class="error-message">
          <ion-icon name="alert-circle-outline"></ion-icon>
          El apellido es requerido y debe tener mínimo 2 letras
        </div>
      }
    </div>

    <!-- Información de Contacto -->
    <div class="form-section">
      <h3 class="section-title">
        <ion-icon name="mail-outline"></ion-icon>
        Información de Contacto
      </h3>
      
      <ion-item fill="outline" class="form-item">
        <ion-label position="floating">Correo (opcional)</ion-label>
        <ion-input formControlName="correo" type="email"></ion-input>
        <ion-icon name="mail-outline" slot="start" color="medium"></ion-icon>
      </ion-item>
      @if (alumnoForm.get('correo')?.invalid && alumnoForm.get('correo')?.touched) {
        <div class="error-message">
          <ion-icon name="alert-circle-outline"></ion-icon>
          El correo no es válido
        </div>
      }

      <ion-item fill="outline" class="form-item">
        <ion-label position="floating">Teléfono (opcional)</ion-label>
        <ion-input formControlName="telefono" type="tel"></ion-input>
        <ion-icon name="call-outline" slot="start" color="medium"></ion-icon>
      </ion-item>
      @if (alumnoForm.get('telefono')?.invalid && alumnoForm.get('telefono')?.touched) {
        <div class="error-message">
          <ion-icon name="alert-circle-outline"></ion-icon>
          El teléfono debe tener 10 dígitos
        </div>
      }
    </div>

    <!-- Asignaciones -->
    <div class="form-section">
      <h3 class="section-title">
        <ion-icon name="school-outline"></ion-icon>
        Asignaciones
      </h3>
      
      <ion-item fill="outline" class="form-item">
        <ion-label>Grupo *</ion-label>
        <ion-select 
          formControlName="grupoId" 
          placeholder="Selecciona un grupo"
          interface="action-sheet">
          @for (grupo of grupos; track grupo.id) {
            <ion-select-option [value]="grupo.id">
              {{ grupo.nombre }}
            </ion-select-option>
          }
        </ion-select>
        <ion-icon name="school-outline" slot="start" color="medium"></ion-icon>
      </ion-item>
      @if (alumnoForm.get('grupoId')?.invalid && alumnoForm.get('grupoId')?.touched) {
        <div class="error-message">
          <ion-icon name="alert-circle-outline"></ion-icon>
          Selecciona un grupo
        </div>
      }

      <ion-item fill="outline" class="form-item">
        <ion-label>Tutor *</ion-label>
        <ion-select 
          formControlName="tutorId" 
          placeholder="Selecciona un tutor"
          interface="action-sheet">
          @for (tutor of tutores; track tutor.id) {
            <ion-select-option [value]="tutor.id">
              {{ tutor.nombre }} {{ tutor.apellido }}
            </ion-select-option>
          }
        </ion-select>
        <ion-icon name="people-outline" slot="start" color="medium"></ion-icon>
      </ion-item>
      @if (alumnoForm.get('tutorId')?.invalid && alumnoForm.get('tutorId')?.touched) {
        <div class="error-message">
          <ion-icon name="alert-circle-outline"></ion-icon>
          Selecciona un tutor
        </div>
      }
    </div>

    <!-- Foto del Alumno -->
    <div class="form-section">
      <h3 class="section-title">
        <ion-icon name="camera-outline"></ion-icon>
        Foto del Alumno
      </h3>
      
      <div class="photo-section">
        @if (fotoPreview) {
          <div class="photo-preview">
            <img [src]="fotoPreview" alt="Vista previa" />
            <ion-button 
              fill="clear" 
              color="danger" 
              class="remove-photo"
              (click)="eliminarFoto()">
              <ion-icon name="trash-outline"></ion-icon>
            </ion-button>
          </div>
        } @else {
          <div class="photo-placeholder" (click)="fileInput.click()">
            <ion-icon name="camera-outline" size="large" color="medium"></ion-icon>
            <p>Toca para cambiar foto</p>
          </div>
        }
        
        <input 
          #fileInput
          type="file" 
          (change)="onImageSelected($event)" 
          accept="image/*" 
          style="display: none;" />
        
        <ion-button 
          expand="block" 
          fill="outline" 
          (click)="fileInput.click()">
          <ion-icon name="camera-outline" slot="start"></ion-icon>
          {{ fotoPreview ? 'Cambiar Foto' : 'Seleccionar Foto' }}
        </ion-button>
      </div>
    </div>

    <!-- Botones de Acción -->
    <div class="action-buttons">
      <ion-button 
        expand="block" 
        type="submit" 
        [disabled]="alumnoForm.invalid"
        size="large"
        color="warning">
        <ion-icon name="checkmark-outline" slot="start"></ion-icon>
        Actualizar Alumno
      </ion-button>
      
      <ion-button 
        expand="block" 
        fill="clear" 
        color="medium"
        (click)="cerrarModal()">
        Cancelar
      </ion-button>
    </div>
  </form>
</ion-content>
